# TSS Key Generation

The TSS key generation process is a first and crucial step in the TSS (Threshold Signature Scheme) protocol,
when the TSS key shares are generated and distributed among the TSS participants.

## Prerequisites
- HashiCorp Vault is properly configured and started (see [Vault configuration](./04_configuration.md#vault-configuration) for details);
- Local party's Cosmos account private key and self-signed TLS certificate are preconfigured in the Vault 
(see [Required secrets](./04_configuration.md#required-secrets) for details;
see [Howto](#howto) on how to generate the self-signed TLS certificate);
- Service configuration file is properly configured (see [Configuration](./04_configuration.md#configuration-file) for details);

## Steps

### 1. Generate preparams
Before starting the key generation process, each party should firstly independently generate preparameters;
that will be required further.

This can be done by executing the following command:
```bash
tss-svc helpers generate preparams -c <path-to-config-file> -o vault
```

It can take a while, so be patient. Ensure that the `-o` flag is set to `vault` to store the generated preparameters in the Vault.
Additionally, you can use the `-o` flag to save them locally or print them to the console.

### 2. Modify the configuration file

Find the `tss` section in the configuration file:
```yaml
# TSS configuration
tss:
  # session start time (should be in the future)
  start_time: "2025-01-21 15:28:00"
  # session Identifier
  session_id: 123
  # TSS threshold
  threshold: 2
```

Set the `start_time` to a future date and time (in UTC) when the TSS keygen session should start.
Additionally, set the `session_id` to a unique identifier for the TSS session.
Set the `threshold` to define the number of parties that will be required to sign a single piece of data.

**Note**:
- **At least `threshold + 1` parties will be required for signing** 
- **`tss` section fields should be the same for all parties**


### 3. Start the service in keygen mode
Now everything is ready to start the TSS service in keygen mode.

To do this, execute the following command:
```bash
tss-svc service run keygen -c <path-to-config-file> -o vault
```

This command will start the TSS service in keygen mode and it will wait for the session start time to begin the key generation process.
It is crucial for each party to be ready to start the key generation process at the same time, so if at least one party is not ready,
the key generation process will not start.

The `-o` flag is set to `vault` to store the generated key shares in the Vault.

## Howto

### Generate self-signed TLS certificate
Self-signed TLS certificate is required for the TSS service to establish secure connections between parties.
It can be generated by using the means of the `openssl` tool.

The example shell script to generate a self-signed TLS certificate can be observed [here](./../build/scripts/gen-certs.sh)